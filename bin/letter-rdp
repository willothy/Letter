#!/usr/bin/env node

'use strict';

const { Parser } = require('../src/Parser');

const fs = require('fs');

Error.stackTraceLimit = 0; // Don't print js stack trace when --stack isn't enabled

function main(argv) {
    const [_node, _path, mode, exp, ...rest] = argv;

    let listTokens = false;
    if (rest.includes('-t') || rest.includes('--tokens')) {
        listTokens = true;
    }
    let printStackTrace = false;
    if (rest.includes('-s') || rest.includes('--stack')) {
        printStackTrace = true;
        Error.stackTraceLimit = 100;
        // TODO: Implement parser stack trace
    }

    const parser = new Parser(listTokens);

    let ast = null;
    if (mode == '-e') {
        ast = parser.parse(exp);
    } else if (mode == '-f') {
        const src = fs.readFileSync(exp, 'utf-8');
        ast = parser.parse(src);
    }

    if (listTokens === true) {
        console.log(JSON.stringify(parser.tokenList, null, 2));
    }

    if (rest.includes('-a') || rest.includes('--ast')) {
        console.log(JSON.stringify(ast, null, 2));
    }

    
    
}

main(process.argv);
